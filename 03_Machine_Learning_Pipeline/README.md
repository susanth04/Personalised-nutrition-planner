# ğŸš€ Personalized Nutrition API - Backend

FastAPI-based backend for personalized nutrition recommendations using XGBoost and microbiome analysis.

## ğŸ“‹ Features

- **RESTful API** - FastAPI with automatic OpenAPI documentation
- **XGBoost Model** - Pre-trained model for nutrition predictions
- **Digital Twin Simulation** - Microbiome-based health predictions
- **CORS Enabled** - Ready for frontend integration
- **Production Ready** - Configured for Render deployment

## ğŸ› ï¸ Tech Stack

- **Framework**: FastAPI 0.104.1
- **Server**: Uvicorn with Gunicorn
- **ML**: XGBoost 2.0.0, scikit-learn 1.3.0
- **Data**: Pandas 2.1.0, NumPy 1.24.4
- **Python**: 3.9.18

## ğŸ“¦ Required Files for Deployment

### Essential Files Only:
```
03_Machine_Learning_Pipeline/
â”œâ”€â”€ requirements.txt              âœ… Dependencies
â”œâ”€â”€ runtime.txt                   âœ… Python version
â”œâ”€â”€ render.yaml                   âœ… Render config
â”œâ”€â”€ render_launcher.py            âœ… Entry point
â”œâ”€â”€ API_and_Models/
â”‚   â”œâ”€â”€ FastAPI_Backend_Server.py âœ… Main API
â”‚   â”œâ”€â”€ Digital_Twin_Simulation_Engine.py âœ… Simulation
â”‚   â”œâ”€â”€ Feature_Scaler_Model.pkl  âœ… Scaler model
â”‚   â”œâ”€â”€ XGBoost_Hyperparameter_Configuration.json âœ… XGBoost model
â”‚   â””â”€â”€ XGBoost_Model_Predictions.csv âœ… (if exists)
```

**Total Size**: ~5-20MB (without unnecessary data files)

## ğŸš€ Deploy to Render

### Option 1: Via Render Dashboard (Recommended)

1. **Go to [render.com](https://render.com)** and sign in
2. **Click "New +" â†’ "Web Service"**
3. **Connect your GitHub repository**
4. **Configure:**
   - **Name**: `nutrition-api` (or your choice)
   - **Root Directory**: `03_Machine_Learning_Pipeline`
   - **Runtime**: Python 3
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `python render_launcher.py`
5. **Environment Variables**: (will auto-generate API_KEY)
6. **Click "Create Web Service"**
7. **Wait 3-5 minutes for deployment**

### Option 2: Via render.yaml (Blueprint)

1. Push code to GitHub
2. In Render Dashboard: New â†’ Blueprint
3. Connect repository
4. It will auto-detect `render.yaml`
5. Click "Apply"

## ğŸ”§ Environment Variables

| Variable | Description | Required |
|----------|-------------|----------|
| `PORT` | Server port (auto-set by Render) | Auto |
| `API_KEY` | API authentication key | Auto-generated |
| `PYTHON_VERSION` | Python version | Set in render.yaml |

## ğŸ§ª Local Testing

```bash
# Navigate to backend directory
cd 03_Machine_Learning_Pipeline

# Install dependencies
pip install -r requirements.txt

# Run the server
python render_launcher.py

# Server will start at http://localhost:8000
```

## ğŸ“¡ API Endpoints

Once deployed, your API will have:

- `GET /` - Health check
- `GET /docs` - Interactive API documentation (Swagger UI)
- `GET /redoc` - Alternative API documentation
- `POST /meal-plan` - Generate personalized meal plan
- `POST /digital-twin` - Run microbiome simulation
- `GET /health` - Health status

**Access docs at**: `https://your-app.onrender.com/docs`

## ğŸ”— Connect to Frontend

After deployment, update your frontend environment variable:

```bash
# In your Vercel frontend
NEXT_PUBLIC_API_URL=https://your-app.onrender.com
```

Also update CORS in `FastAPI_Backend_Server.py`:
```python
allow_origins=[
    "https://your-frontend.vercel.app",  # Add your Vercel URL
]
```

## ğŸ“Š Deployment Checklist

- [ ] Push code to GitHub
- [ ] Create Render web service
- [ ] Set root directory to `03_Machine_Learning_Pipeline`
- [ ] Verify build command: `pip install -r requirements.txt`
- [ ] Verify start command: `python render_launcher.py`
- [ ] Wait for deployment to complete
- [ ] Test API at `/docs` endpoint
- [ ] Update frontend with API URL
- [ ] Update CORS settings with frontend URL
- [ ] Test meal plan endpoint
- [ ] Test digital twin endpoint

## ğŸ› Troubleshooting

### Build Fails
- Check `requirements.txt` has all dependencies
- Verify Python version in `runtime.txt`
- Check build logs in Render dashboard

### Model Files Missing
- Ensure `.pkl` and `.json` files are committed
- Check `.gitignore` isn't excluding them
- Verify files exist in repository

### Import Errors
- Check `sys.path` in `render_launcher.py`
- Verify directory structure matches imports
- Check all required Python packages installed

### CORS Errors
- Add frontend URL to `allow_origins` list
- Redeploy after CORS changes
- Check frontend is using correct API URL

## ğŸ“ Notes

- Free tier on Render may have cold starts (~30s)
- Logs available in Render dashboard
- Automatic HTTPS provided by Render
- Auto-redeploy on git push (if enabled)

## ğŸ”’ Security

- API key auto-generated by Render
- HTTPS enforced in production
- CORS configured for specific origins
- Input validation via Pydantic models

---

**Ready to deploy!** Follow the steps above to get your API live on Render.
